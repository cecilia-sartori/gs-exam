<!DOCTYPE html>

<html>

  <script src="/assets/global/jquery-3.6.0.min.js"></script>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    Display VAW - The worst neighborhood to be a Women in Mexico City
    
  </title>

  <meta name="description" content="A geospatial analysis of gender-based violence locations">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2_mapping/">
  <link rel="alternate" type="application/rss+xml" title="The worst neighborhood to be a Women in Mexico City" href="/feed.xml">

</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/"> 
      <img class="logo-dark" src="/img/unitn_logo_dark.png" alt="">
      <img class="logo-light" src="/img/unitn_logo_light.png" alt="">
    
    </a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/1_intro">intro</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/2_mapping">mapping vaw</a>
        </li> 
        <li class="nav-item">
          <a class="nav-link" href="/3_spatialCorr">spatial analysis</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/4_streetNxAnalysis">street network</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/5_conclusion">conclusion</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="https://github.com/cecilia-sartori/gs-exam">git hub</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->

<header class="masthead" style="background-image: url('/img/bg_mapping.jpg')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="page-heading">
            <h1>Display VAW</h1>
            
            <span class="subheading">Get visual intuitions from data</span>
            
          </div>
        </div>
      </div>
    </div>
  </header>

  <script src="/assets/global/anchor.min.js"></script>

  <script>
	$(function() {
		anchors.options.visible = 'touch'; 
		anchors.add('.post-content > h1, h2');
	});
</script>


  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <p>First, I need the geography of the city. The smaller the geography, the better the spatial data analysis will be. For this task, I use the Basic Unit of the National Geostatistical Framework (AGEB) that provides a small enough  boundary layer. Additionally, working with AGEB will be useful for future analyses that include census data, since it represents the common framework for any data sets of the Mexican Institute of Statistics (INEGI).</p>

<h2 id="get-block-groups-data-from-mexican-national-geoinformation-portal">Get Block Groups Data from Mexican National Geoinformation Portal</h2>

<p>The portal has several options for formats to export. In this case, I select Shapefile format.</p>

<p>The data set is licensed under the Mexican open data licence (CC BY-NC 2.5 MX).</p>

<ul>
  <li>
    <p><strong>Date source</strong>:</p>

    <p><a href="http://geoportal.conabio.gob.mx/metadatos/doc/html/agbumge19gw.html">Área geoestadística básica urbana, 2019 - Portal de Geoinformación 2022</a></p>
  </li>
  <li>
    <p><strong>Data Structure</strong>:</p>

    <p>Structure of the data is described in a separate pdf file <a href="/pdf/contenido.pdf">link here</a></p>
  </li>
</ul>

<p><span style="white-space: pre"> 
For this part, I’ll need the following modules:</span></p>

<ul>
  <li>
    <p>Pandas for handling csv files</p>
  </li>
  <li>
    <p>Geopandas for handling spatial data</p>
  </li>
  <li>
    <p>Matplotlib for plotting figures</p>
  </li>
  <li>Contextily for adding basemaps</li>
  <li>
    <p>Plotly for interactive bar chart</p>
  </li>
  <li>Folium for plotting interactive maps based on leaflet.js</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Import required modules
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="n">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="n">ctx</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="n">px</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">from</span> <span class="nn">folium</span> <span class="kn">import</span> <span class="n">plugins</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Read the data
</span><span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="p">.</span><span class="n">read_file</span><span class="p">(</span><span class="s">'data/ageb/agbumge19gw.shp'</span><span class="p">)</span>
<span class="n">gdf</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<div>
<div class="table-wrapper">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CVEGEO</th>
      <th>CVE_ENT</th>
      <th>CVE_MUN</th>
      <th>CVE_LOC</th>
      <th>CVE_AGEB</th>
      <th>NOM_ENT</th>
      <th>NOM_MUN</th>
      <th>AREA</th>
      <th>PERIMETER</th>
      <th>COV_</th>
      <th>COV_ID</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1890</th>
      <td>211140001645A</td>
      <td>21</td>
      <td>114</td>
      <td>0001</td>
      <td>645A</td>
      <td>Puebla</td>
      <td>Puebla</td>
      <td>0.882806</td>
      <td>6.957708</td>
      <td>1890</td>
      <td>1891</td>
      <td>POLYGON ((-98.26667 18.98986, -98.26667 18.989...</td>
    </tr>
    <tr>
      <th>35149</th>
      <td>1510400010088</td>
      <td>15</td>
      <td>104</td>
      <td>0001</td>
      <td>0088</td>
      <td>MÃ©xico</td>
      <td>Tlalnepantla de Baz</td>
      <td>0.469979</td>
      <td>5.239753</td>
      <td>35149</td>
      <td>35150</td>
      <td>POLYGON ((-99.21126 19.56415, -99.21127 19.564...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<p>CVEGEO is the concatenated geostatistical key that summarises all subsequent elements. This key will be crucial for merging AGEB data with other sources.</p>

<p>Keep only Mexico City by using the corresponding federal entity key, equal to <code class="language-plaintext highlighter-rouge">09</code> (<a href="/pdf/municipios.pdf">source</a>).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s">'CVE_ENT'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'09'</span><span class="p">]</span>
</code></pre></div></div>

<p>Proceed by filtering the data to only include the relevant columns, namely <code class="language-plaintext highlighter-rouge">CVEGEO</code> and <code class="language-plaintext highlighter-rouge">geometry</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[[</span><span class="s">'CVEGEO'</span><span class="p">,</span> <span class="s">'geometry'</span><span class="p">]]</span>
</code></pre></div></div>

<p>Inspect the geometries by plotting with matplotlib.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">gdf</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/img/2_mapping/output_10_0.png" alt="city" /></p>

<p>Is this Mexico City? 
To check it, add a basemap. 
Running the code in the notebook, this can be done easily with the following line of code.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdf</span><span class="p">.</span><span class="n">explore</span><span class="p">()</span>
</code></pre></div></div>

<p>But nothing is displayed outside the jupyter environment. I use <code class="language-plaintext highlighter-rouge">contextily</code> to add a basemap to the static map of the geometries.</p>

<p>This package assumes that the Coordinate Reference Systems of the data is in Spherical Mercator (EPSG:3857), unless other crs is specified (<a href="https://contextily.readthedocs.io/en/latest/reference.html">documentation</a>).</p>

<p>So, first check CRS format of our data.</p>

<p><strong>Dealing With Coordinate Reference Systems (CRS)</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># check the CRS
</span><span class="n">gdf</span><span class="p">.</span><span class="n">crs</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich
</code></pre></div></div>

<p>As can be seen above, the CRS is in EPSG:4326. So, to plot the basemap, I can either specify the parameter or reproject the data into EPSG 3857.</p>

<p>Overall, EPSG 3857 is the preferred CRS for web maps, so I opt for reprojecting.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># reproject to web mercator
</span><span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</code></pre></div></div>

<p>And plot the city geometries with the basemap.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">gdf</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
         <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> 
         <span class="n">edgecolor</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span>
         <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
         <span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>

<span class="c1"># add basemap
</span><span class="n">ctx</span><span class="p">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="p">.</span><span class="n">providers</span><span class="p">.</span><span class="n">OpenStreetMap</span><span class="p">.</span><span class="n">Mapnik</span><span class="p">)</span>

</code></pre></div></div>

<p><img src="/img/2_mapping/output_19_0.png" alt="cdmx_18" /></p>

<p>Now that the spatial information is proven to be correct, let’s enrich the geometries with the latest census of population and housing (2020). This makes the data much more informative about the socioeconomic status of the people living in each block and provides the explanatory variables for futere spatial regression analysis.</p>

<h2 id="get-data-of-2020-census-of-population-and-housing">Get data of 2020 Census of Population and Housing</h2>

<p>The data set is licensed under the Mexican open data licence (CC BY-NC 2.5 MX).</p>

<ul>
  <li>
    <p><strong>Date source</strong>:</p>

    <p><a href="https://www.gob.mx/inea/documentos/resultados-del-censo-de-poblacion-y-vivienda-2020-inegi">Censo de Población y Vivienda 2020 - INEGI</a></p>
  </li>
  <li>
    <p><strong>Data Structure</strong>:</p>

    <p>Structure of the data is described in a separate pdf file (<a href="">link here</a>)</p>
  </li>
</ul>

<p>The data below have been roughly cleaned before importing. See the step <a href="/0_datasets/#census-data">here</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/census_data2020.csv'</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<div class="divScroll">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CVEGEO</th>
      <th>ENTIDAD</th>
      <th>NOM_ENT</th>
      <th>MUN</th>
      <th>NOM_MUN</th>
      <th>LOC</th>
      <th>NOM_LOC</th>
      <th>AGEB</th>
      <th>MZA</th>
      <th>POBTOT</th>
      <th>...</th>
      <th>VPH_TELEF</th>
      <th>VPH_CEL</th>
      <th>VPH_INTER</th>
      <th>VPH_STVP</th>
      <th>VPH_SPMVPI</th>
      <th>VPH_CVJ</th>
      <th>VPH_SINRTV</th>
      <th>VPH_SINLTC</th>
      <th>VPH_SINCINT</th>
      <th>VPH_SINTIC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0900200010010</td>
      <td>9</td>
      <td>Ciudad de México</td>
      <td>2</td>
      <td>Azcapotzalco</td>
      <td>1</td>
      <td>Total AGEB urbana</td>
      <td>0010</td>
      <td>0</td>
      <td>3183.0</td>
      <td>...</td>
      <td>741.0</td>
      <td>772.0</td>
      <td>692.0</td>
      <td>313.0</td>
      <td>221.0</td>
      <td>145.0</td>
      <td>8.0</td>
      <td>14.0</td>
      <td>148.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0900200010025</td>
      <td>9</td>
      <td>Ciudad de México</td>
      <td>2</td>
      <td>Azcapotzalco</td>
      <td>1</td>
      <td>Total AGEB urbana</td>
      <td>0025</td>
      <td>0</td>
      <td>5593.0</td>
      <td>...</td>
      <td>1373.0</td>
      <td>1510.0</td>
      <td>1203.0</td>
      <td>478.0</td>
      <td>349.0</td>
      <td>238.0</td>
      <td>28.0</td>
      <td>68.0</td>
      <td>393.0</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>090020001003A</td>
      <td>9</td>
      <td>Ciudad de México</td>
      <td>2</td>
      <td>Azcapotzalco</td>
      <td>1</td>
      <td>Total AGEB urbana</td>
      <td>003A</td>
      <td>0</td>
      <td>4235.0</td>
      <td>...</td>
      <td>965.0</td>
      <td>1049.0</td>
      <td>878.0</td>
      <td>361.0</td>
      <td>339.0</td>
      <td>247.0</td>
      <td>5.0</td>
      <td>12.0</td>
      <td>250.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0900200010044</td>
      <td>9</td>
      <td>Ciudad de México</td>
      <td>2</td>
      <td>Azcapotzalco</td>
      <td>1</td>
      <td>Total AGEB urbana</td>
      <td>0044</td>
      <td>0</td>
      <td>4768.0</td>
      <td>...</td>
      <td>1124.0</td>
      <td>1237.0</td>
      <td>1076.0</td>
      <td>481.0</td>
      <td>452.0</td>
      <td>294.0</td>
      <td>10.0</td>
      <td>17.0</td>
      <td>254.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0900200010097</td>
      <td>9</td>
      <td>Ciudad de México</td>
      <td>2</td>
      <td>Azcapotzalco</td>
      <td>1</td>
      <td>Total AGEB urbana</td>
      <td>0097</td>
      <td>0</td>
      <td>2176.0</td>
      <td>...</td>
      <td>517.0</td>
      <td>562.0</td>
      <td>507.0</td>
      <td>276.0</td>
      <td>260.0</td>
      <td>153.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>70.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 231 columns</p>
</div>
</div>

<p>As can be seen, census dataset comes with a lot of information. Column headers are defined in the data structure file mentioned above. Here below find the description of what I consider interesting to keep. Drop the rest.</p>

<table>
  <thead>
    <tr>
      <th>CODE</th>
      <th>CATEGORY</th>
      <th style="text-align: left">DESCRIPTION</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>CVEGEO</strong></td>
      <td>GEO</td>
      <td style="text-align: left">Geostatistical key</td>
    </tr>
    <tr>
      <td><strong>POBTOT</strong></td>
      <td>POPULATION</td>
      <td style="text-align: left">Total number of people habitually living in the federal entity</td>
    </tr>
    <tr>
      <td><strong>PRESOE15</strong></td>
      <td>MIGRATION</td>
      <td style="text-align: left">Population from 5 to 130 years of age who in 2015 resided in another federal entity</td>
    </tr>
    <tr>
      <td><strong>P5_HLI</strong></td>
      <td>ETNICITY</td>
      <td style="text-align: left">Population from 5 to 130 years of age who speak an indigenous language</td>
    </tr>
    <tr>
      <td><strong>POB_AFRO</strong></td>
      <td>ETNICITY</td>
      <td style="text-align: left">Population that considers itself Afro-Mexican or Afro-descendant</td>
    </tr>
    <tr>
      <td><strong>GRAPROES</strong></td>
      <td>EDUCATION</td>
      <td style="text-align: left">Average degree of education</td>
    </tr>
    <tr>
      <td><strong>PDESOCUP</strong></td>
      <td>OCCUPATION</td>
      <td style="text-align: left">Population of 12 years and more unemployed</td>
    </tr>
    <tr>
      <td><strong>PSINDER</strong></td>
      <td>HEALTH</td>
      <td style="text-align: left">Population with no access to health care</td>
    </tr>
    <tr>
      <td><strong>VPH_SINLTC</strong></td>
      <td>DIGITAL ACCESS</td>
      <td style="text-align: left">Homes with no landline or cell phone</td>
    </tr>
    <tr>
      <td><strong>VPH_SINCINT</strong></td>
      <td>DIGITAL ACCESS</td>
      <td style="text-align: left">Homes with no computer or Internet</td>
    </tr>
  </tbody>
</table>

<p>Transfer census attributes to AGEB GeoDataFrame by merging on the geostatistical key. Put gdf on the left to keep spatial format in the resulting output.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdf</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">gdf</span><span class="p">,</span> <span class="n">df</span><span class="p">[[</span><span class="s">'CVEGEO'</span><span class="p">,</span> <span class="s">'POBTOT'</span><span class="p">,</span> <span class="s">'PRESOE15'</span><span class="p">,</span>
                        <span class="s">'P5_HLI'</span><span class="p">,</span> <span class="s">'POB_AFRO'</span><span class="p">,</span> <span class="s">'GRAPROES'</span><span class="p">,</span>
                        <span class="s">'PDESOCUP'</span><span class="p">,</span> <span class="s">'PSINDER'</span><span class="p">,</span> <span class="s">'VPH_SINLTC'</span> <span class="p">,</span>
                        <span class="s">'VPH_SINCINT'</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s">"CVEGEO"</span><span class="p">)</span>
</code></pre></div></div>

<p>Some AGEB unit are very small and might refer to few or no people. Get rid of blocks groups with less than 100 total population to further clean the data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s">'POBTOT'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">]</span>
</code></pre></div></div>

<p>Finally, retrieve the data about violence against women from the Mexico City’s Open Data Portal.</p>

<h3 id="get-vaw-data-from-cmdx-open-data-portal">Get VAW Data from CMDX Open Data Portal</h3>

<p>VAW data of Mexico City is included in the crime victim dataset. This means that I have to identify which rows are significant to the project based on the description of the crime and the victim’s gender.</p>

<p>The data set is licensed under the open data licence (CC BY 4.0).</p>

<ul>
  <li>
    <p><strong>Date source</strong>:</p>

    <p><a href="https://datos.cdmx.gob.mx/dataset/victimas-en-carpetas-de-investigacion-fgj">Crime victims complaints - Mexico City Open Data Portal</a></p>
  </li>
  <li>
    <p><strong>Data Structure</strong>:</p>

    <p>Structure of the data is described in a separate excel file (<a href="https://datos.cdmx.gob.mx/dataset/victimas-en-carpetas-de-investigacion-fgj/resource/10235569-f4a9-4876-9465-9780887df8e2">download here</a>)</p>
  </li>
</ul>

<p><strong>This datasets have been extensively pre-processed <a href="/0_datasets/#vaw-data">here</a></strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Read data
</span><span class="n">vaw</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/vaw_filtered.csv'</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Exploring Data: Types of violence against women in Mexico City</strong></p>

<p>Most violence against women is perpetrated by current or former intimate partner and occurs in domestic settings, according to UN (<a href="https://www.who.int/publications/i/item/9789240022256a">source</a>). Find out what type occurs most in CDMX using an interactive bar plot.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create a copy to compute required values for the plot
</span><span class="n">data</span> <span class="o">=</span> <span class="n">vaw</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span> 

<span class="c1"># convert time to a datetime64 type 
</span><span class="n">data</span><span class="p">[</span><span class="s">'Time'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'Time'</span><span class="p">])</span>
<span class="n">data</span><span class="p">[</span><span class="s">'Month'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'Time'</span><span class="p">].</span><span class="n">dt</span><span class="p">.</span><span class="n">month</span> <span class="c1"># extract the numeric value of months
</span>
<span class="c1"># group crime by type and count occurrence
</span><span class="n">occur_type</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'Crime'</span><span class="p">,</span> <span class="s">'Month'</span><span class="p">]).</span><span class="n">size</span><span class="p">())</span>
<span class="n">occur_type</span> <span class="o">=</span> <span class="n">occur_type</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">'Reported'</span><span class="p">})</span> <span class="c1"># rename the column
</span>
<span class="c1"># order from Jan to Dec
</span><span class="n">occur_type</span><span class="p">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s">"Month"</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">occur_type</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="c1"># reset index
</span>
<span class="n">occur_type</span><span class="p">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Crime</th>
      <th>Month</th>
      <th>Reported</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>69</th>
      <td>FEMICIDE</td>
      <td>12</td>
      <td>4</td>
    </tr>
    <tr>
      <th>70</th>
      <td>DOMESTIC VIOLENCE</td>
      <td>12</td>
      <td>661</td>
    </tr>
    <tr>
      <th>71</th>
      <td>AGAINST SEXUAL INTIMACY</td>
      <td>12</td>
      <td>26</td>
    </tr>
    <tr>
      <th>72</th>
      <td>SEXUAL ABUSE</td>
      <td>12</td>
      <td>76</td>
    </tr>
    <tr>
      <th>73</th>
      <td>SEXUAL HARASSMENT</td>
      <td>12</td>
      <td>26</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># and plot it
</span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="n">occur_type</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Month"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'Reported'</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">"Crime"</span><span class="p">,</span>
             <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s">'Crime'</span> <span class="p">:</span> <span class="bp">True</span> <span class="p">,</span>
                         <span class="s">'Month'</span> <span class="p">:</span> <span class="bp">False</span>
                               <span class="p">},</span>
             <span class="c1"># costumize colours
</span>             <span class="n">color_discrete_map</span><span class="o">=</span><span class="p">{</span><span class="s">"DOMESTIC VIOLENCE"</span><span class="p">:</span> <span class="s">"darkblue"</span><span class="p">,</span>
                                 <span class="s">"FEMINICIDE"</span><span class="p">:</span> <span class="s">"royalblue"</span><span class="p">,</span>
                                 <span class="s">"SEXUAL HARASSMENT"</span> <span class="p">:</span> <span class="s">"cornflowerblue"</span><span class="p">,</span>
                                 <span class="s">"SEXUAL ABUSE"</span><span class="p">:</span> <span class="s">"deeppink"</span><span class="p">,</span>
                                <span class="p">},</span>
             <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s">"Crime"</span> <span class="p">:</span> <span class="s">"Type of violence"</span><span class="p">,</span>
                     <span class="s">"Reported"</span><span class="p">:</span> <span class="s">"Reported violence"</span><span class="p">},</span>
             <span class="n">title</span><span class="o">=</span><span class="s">'Reported Violence Against Women in CDMX by Type, 2021'</span><span class="p">)</span>


<span class="n">fig</span><span class="p">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">orientation</span><span class="o">=</span><span class="s">"h"</span><span class="p">,</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.2</span>
        <span class="p">),</span>
    <span class="n">legend_title_text</span><span class="o">=</span><span class="s">''</span>

<span class="p">)</span>


<span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s">'displayModeBar'</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>

<span class="c1">#fig.write_html("output/VAW_in_CDMX_byType.html",config=config)
#fig.show(config=config)
</span></code></pre></div></div>

<iframe src="/img/output/VAW_in_CDMX_byType.html" height="400px" width="100%"></iframe>

<p>Click on the legend entries to hide and show traces.</p>

<p>The trend stated by UN have proven to be true for Mexico City. It is worth noting that the number of reported violence is stable throughout the year, but decreases significantly in the months of November and December, revealing that perhaps during the holidays it is more difficult for women to report.</p>

<p>Back to VAW dataframe. Print a summary of the data types:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get the data types
</span><span class="n">vaw</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 25419 entries, 480286 to 679497
Data columns (total 4 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Time       25419 non-null  object 
 1   Crime      25419 non-null  object 
 2   latitude   25419 non-null  float64
 3   longitude  25419 non-null  float64
dtypes: float64(2), object(2)
memory usage: 992.9+ KB
</code></pre></div></div>

<p>I can’t plot this data on a map because no geometry is listed in the data type column. I need to convert the latitude and longitude into appropriate spatial information.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># convert df to geodataframe
</span><span class="n">vaw_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="p">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">vaw</span><span class="p">,</span>
                         <span class="n">crs</span><span class="o">=</span><span class="s">'EPSG:4326'</span><span class="p">,</span> <span class="c1"># lat and long are in degree
</span>                         <span class="n">geometry</span><span class="o">=</span> <span class="n">gpd</span><span class="p">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">vaw</span><span class="p">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">vaw</span><span class="p">.</span><span class="n">latitude</span><span class="p">))</span>
<span class="n">vaw_gdf</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div>
<div class="table-wrapper">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Crime</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>480286</th>
      <td>01/01/2021</td>
      <td>DOMESTIC VIOLENCE</td>
      <td>19.198153</td>
      <td>-99.026277</td>
      <td>POINT (-99.02628 19.19815)</td>
    </tr>
    <tr>
      <th>480289</th>
      <td>01/01/2021</td>
      <td>DOMESTIC VIOLENCE</td>
      <td>19.193027</td>
      <td>-99.095006</td>
      <td>POINT (-99.09501 19.19303)</td>
    </tr>
    <tr>
      <th>480302</th>
      <td>01/01/2021</td>
      <td>DOMESTIC VIOLENCE</td>
      <td>19.336963</td>
      <td>-99.152265</td>
      <td>POINT (-99.15227 19.33696)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<p>Finally, I can plot the VAW locations. However, if many points are concentrated in some areas, then the dots overlap and this makes it hard to understand any pattern.</p>

<p>To represents the locations in a more informative way, use hexagonal cells.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot hexbins with Matplotlib
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="n">hb</span><span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">vaw_gdf</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">'longitude'</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span> <span class="s">'latitude'</span><span class="p">,</span>
    <span class="n">gridsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="c1"># size of hexagonal cells
</span>    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
    <span class="n">cmap</span><span class="o">=</span><span class="s">'viridis_r'</span>
<span class="p">)</span>

<span class="c1"># no axis
</span><span class="n">ax</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="c1"># add bar side
</span><span class="n">fig</span><span class="p">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">0</span> <span class="p">);</span>

<span class="c1"># hexbin takes lat and lon as arguments --&gt; specify crs
</span><span class="n">ctx</span><span class="p">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="p">.</span><span class="n">providers</span><span class="p">.</span><span class="n">OpenStreetMap</span><span class="p">.</span><span class="n">Mapnik</span><span class="p">,</span>
                <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/img/2_mapping/output_56_0.png" alt="cdmx_54" /></p>

<p>The color of each hexbin denotes the number of points in it.</p>

<p>With this map, I can instantly draw conclusions. For instance, I see that most cases occurs near the city center.</p>

<h2 id="combine-data">Combine Data</h2>

<p>At this point, I have two GeoDataFrames: one with the AGEB polygons and the other with the points where the violence took place. I just have to join the two pieces of information with a spatial join.</p>

<p>To do that, I need both data sets with the same map projection.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># reproject vaw_gdf to web mercator
</span><span class="n">vaw_gdf</span> <span class="o">=</span> <span class="n">vaw_gdf</span><span class="p">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
</code></pre></div></div>

<p>The following code creates a GeoDataFrame that has every vaw record with the corresponding CVEGEO code.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">join</span> <span class="o">=</span> <span class="n">gpd</span><span class="p">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">vaw_gdf</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'left'</span><span class="p">)</span>
<span class="n">join</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div>
<div class="table-wrapper">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Crime</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>geometry</th>
      <th>index_right</th>
      <th>CVEGEO</th>
      <th>POBTOT</th>
      <th>PRESOE15</th>
      <th>P5_HLI</th>
      <th>POB_AFRO</th>
      <th>GRAPROES</th>
      <th>PDESOCUP</th>
      <th>PSINDER</th>
      <th>VPH_SINLTC</th>
      <th>VPH_SINCINT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>480286</th>
      <td>01/01/2021</td>
      <td>DOMESTIC VIOLENCE</td>
      <td>19.198153</td>
      <td>-99.026277</td>
      <td>POINT (-11023554.739 2178279.222)</td>
      <td>1089.0</td>
      <td>0900900010308</td>
      <td>3177.0</td>
      <td>43.0</td>
      <td>101.0</td>
      <td>15.0</td>
      <td>10.38</td>
      <td>22.0</td>
      <td>1568.0</td>
      <td>61.0</td>
      <td>290.0</td>
    </tr>
    <tr>
      <th>480289</th>
      <td>01/01/2021</td>
      <td>DOMESTIC VIOLENCE</td>
      <td>19.193027</td>
      <td>-99.095006</td>
      <td>POINT (-11031205.607 2177674.892)</td>
      <td>1080.0</td>
      <td>0900900330350</td>
      <td>9142.0</td>
      <td>149.0</td>
      <td>210.0</td>
      <td>27.0</td>
      <td>10.11</td>
      <td>64.0</td>
      <td>2267.0</td>
      <td>115.0</td>
      <td>806.0</td>
    </tr>
    <tr>
      <th>480302</th>
      <td>01/01/2021</td>
      <td>DOMESTIC VIOLENCE</td>
      <td>19.336963</td>
      <td>-99.152265</td>
      <td>POINT (-11037579.654 2194648.346)</td>
      <td>199.0</td>
      <td>0900300010450</td>
      <td>6576.0</td>
      <td>155.0</td>
      <td>58.0</td>
      <td>48.0</td>
      <td>13.21</td>
      <td>101.0</td>
      <td>1764.0</td>
      <td>30.0</td>
      <td>201.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<p><strong>What are the blocks with the highest rate of vaw?</strong></p>

<p>With the hexagonal cells map, I can understand the data distribution at a glance, but nothing about the block groups.</p>

<p>Therefore, create another dataframe that counts violence by their corresponding AGEB.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">reported_by_gdf</span> <span class="o">=</span> <span class="n">join</span><span class="p">.</span><span class="n">CVEGEO</span><span class="p">.</span><span class="n">value_counts</span><span class="p">().</span><span class="n">rename_axis</span><span class="p">(</span><span class="s">'CVEGEO'</span><span class="p">).</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'VAW_COUNT'</span><span class="p">)</span>
<span class="n">reported_by_gdf</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CVEGEO</th>
      <th>VAW_COUNT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>090150001113A</td>
      <td>66</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0901500010875</td>
      <td>60</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0901500011036</td>
      <td>58</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0900300010785</td>
      <td>57</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0900300010963</td>
      <td>53</td>
    </tr>
  </tbody>
</table>
</div>

<p>And now join it back to the AGEB gdf</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdf</span><span class="o">=</span> <span class="n">gdf</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reported_by_gdf</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s">'CVEGEO'</span><span class="p">)</span>
<span class="n">gdf</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<div class="divScroll">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CVEGEO</th>
      <th>geometry</th>
      <th>POBTOT</th>
      <th>PRESOE15</th>
      <th>P5_HLI</th>
      <th>POB_AFRO</th>
      <th>GRAPROES</th>
      <th>PDESOCUP</th>
      <th>PSINDER</th>
      <th>VPH_SINLTC</th>
      <th>VPH_SINCINT</th>
      <th>VAW_COUNT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0900200010148</td>
      <td>POLYGON ((-11043669.988 2213993.494, -11043643...</td>
      <td>2513.0</td>
      <td>85.0</td>
      <td>16.0</td>
      <td>70.0</td>
      <td>13.26</td>
      <td>39.0</td>
      <td>498.0</td>
      <td>4.0</td>
      <td>90.0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0900200010190</td>
      <td>POLYGON ((-11041773.412 2213843.334, -11041760...</td>
      <td>8920.0</td>
      <td>602.0</td>
      <td>113.0</td>
      <td>218.0</td>
      <td>11.55</td>
      <td>134.0</td>
      <td>2011.0</td>
      <td>76.0</td>
      <td>600.0</td>
      <td>34</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0900200010932</td>
      <td>POLYGON ((-11041855.381 2215121.578, -11041824...</td>
      <td>408.0</td>
      <td>28.0</td>
      <td>10.0</td>
      <td>0.0</td>
      <td>11.74</td>
      <td>0.0</td>
      <td>58.0</td>
      <td>0.0</td>
      <td>14.0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0900200010237</td>
      <td>POLYGON ((-11043811.972 2213166.667, -11043827...</td>
      <td>7093.0</td>
      <td>300.0</td>
      <td>61.0</td>
      <td>119.0</td>
      <td>11.13</td>
      <td>115.0</td>
      <td>1881.0</td>
      <td>63.0</td>
      <td>434.0</td>
      <td>24</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0900200010595</td>
      <td>POLYGON ((-11044374.238 2211932.937, -11044339...</td>
      <td>5116.0</td>
      <td>251.0</td>
      <td>65.0</td>
      <td>42.0</td>
      <td>10.59</td>
      <td>70.0</td>
      <td>1324.0</td>
      <td>54.0</td>
      <td>426.0</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<p>The GeoDataFrame now has the vaw count column. So I can easily query the data for finding maximum values. 
However, using the absolute count of violence would be misleading because it doesn’t take into account the number of people living in the block. To solve this issue, let’s compute the vaw rates per 1000 people by AGEB.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdf</span><span class="p">[</span><span class="s">'VAW_per_1000'</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="s">'VAW_COUNT'</span><span class="p">]</span><span class="o">/</span><span class="n">gdf</span><span class="p">[</span><span class="s">'POBTOT'</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Write to GeoJSON to avoid recalculation 
</span>
<span class="n">gdf</span><span class="p">.</span><span class="n">to_file</span><span class="p">(</span><span class="s">"data/VAW_AGEB_clean.gjson"</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s">"GeoJSON"</span><span class="p">)</span>
</code></pre></div></div>

<p>And plot the Top 10 Most Dangerous Blocks:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot the top 10 geographies
</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="n">gdf</span><span class="p">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s">'VAW_per_1000'</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                                                                 <span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">,</span>
                                                                 <span class="n">edgecolor</span><span class="o">=</span><span class="s">'white'</span><span class="p">,</span>
                                                                 <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="c1"># title
</span><span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Top 10 Most Dangerous Blocks for Women in CDMX, 2021'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="c1"># no axis
</span><span class="n">ax</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>

<span class="c1"># add a basemap
</span><span class="n">ctx</span><span class="p">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="p">.</span><span class="n">providers</span><span class="p">.</span><span class="n">CartoDB</span><span class="p">.</span><span class="n">Positron</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/img/2_mapping/output_69_0.png" alt="top10" /></p>

<p>Now visualise the total distribution with a choropleth map:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="n">gdf</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">column</span><span class="o">=</span><span class="s">'VAW_per_1000'</span><span class="p">,</span>
        <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s">'RdYlGn_r'</span><span class="p">,</span>
        <span class="n">scheme</span><span class="o">=</span><span class="s">'quantiles'</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Rates of violence against women per 1000 residents in CDMX, 2021'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">ctx</span><span class="p">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="p">.</span><span class="n">providers</span><span class="p">.</span><span class="n">CartoDB</span><span class="p">.</span><span class="n">Positron</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/img/2_mapping/output_71_0.png" alt="chpl" /></p>

<p>The fugure above presents information in a simple, visual way. However, it would be much better for users to be free to zoom in some areas and play around, namely if the figure were interactive! I can use <code class="language-plaintext highlighter-rouge">folium</code> to accomplish the task.</p>

<p>Moreover, AGEB are really useful to understand whether similar geographies tend to cluster (and apparently they do in this case). But what about the district they belong to?
Let’s find out the worst neighborhood to be a woman in Mexico City - as claimed by the title of the project - by fisrt importing the Neighborhood Data.</p>

<h2 id="get-neighborhood-data">Get Neighborhood Data</h2>

<p>Data comes from Mexico City Open Data Portal and have been cleaned before importig. Find the pre-processign phase <a href="/0_datasets/#neighbourhood-data">here</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Read the data
</span><span class="n">gdf_mun</span> <span class="o">=</span> <span class="n">gpd</span><span class="p">.</span><span class="n">read_file</span><span class="p">(</span><span class="s">'data/CDMX_municipalities.gjson'</span><span class="p">)</span>
<span class="c1"># reproject to web mercator
</span><span class="n">gdf_mun</span> <span class="o">=</span> <span class="n">gdf_mun</span><span class="p">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>

<span class="n">gdf_mun</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CVEGEO</th>
      <th>NOMGEO</th>
      <th>POBTOT</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9009</td>
      <td>MILPA ALTA</td>
      <td>152685</td>
      <td>POLYGON ((-11020321.650 2181716.432, -11020345...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9014</td>
      <td>BENITO JUÁREZ</td>
      <td>434153</td>
      <td>POLYGON ((-11035857.497 2202270.237, -11035860...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9005</td>
      <td>GUSTAVO A. MADERO</td>
      <td>1173351</td>
      <td>POLYGON ((-11033831.810 2223869.140, -11033643...</td>
    </tr>
  </tbody>
</table>
</div>

<p>Run the same operations performed before for AGEB.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Make a spatial join
</span><span class="n">join</span> <span class="o">=</span> <span class="n">gpd</span><span class="p">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">vaw_gdf</span><span class="p">,</span> <span class="n">gdf_mun</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">"left"</span><span class="p">)</span>
<span class="c1"># count vaw per neighbourhood
</span><span class="n">reported_by_gdf</span> <span class="o">=</span> <span class="n">join</span><span class="p">.</span><span class="n">CVEGEO</span><span class="p">.</span><span class="n">value_counts</span><span class="p">().</span><span class="n">rename_axis</span><span class="p">(</span><span class="s">'CVEGEO'</span><span class="p">).</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'VAW_COUNT'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdf_mun</span><span class="o">=</span> <span class="n">gdf_mun</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reported_by_gdf</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s">'CVEGEO'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Compute rate per 1000
</span><span class="n">gdf_mun</span><span class="p">[</span><span class="s">'VAW_per_1000'</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_mun</span><span class="p">[</span><span class="s">'VAW_COUNT'</span><span class="p">]</span><span class="o">/</span><span class="n">gdf</span><span class="p">[</span><span class="s">'POBTOT'</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span>
<span class="n">gdf_mun</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<div class="divScroll">
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CVEGEO</th>
      <th>NOMGEO</th>
      <th>POBTOT</th>
      <th>geometry</th>
      <th>VAW_COUNT</th>
      <th>VAW_per_1000</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9009</td>
      <td>MILPA ALTA</td>
      <td>152685</td>
      <td>POLYGON ((-11020321.650 2181716.432, -11020345...</td>
      <td>508</td>
      <td>202.148826</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9014</td>
      <td>BENITO JUÁREZ</td>
      <td>434153</td>
      <td>POLYGON ((-11035857.497 2202270.237, -11035860...</td>
      <td>904</td>
      <td>101.345291</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9005</td>
      <td>GUSTAVO A. MADERO</td>
      <td>1173351</td>
      <td>POLYGON ((-11033831.810 2223869.140, -11033643...</td>
      <td>3284</td>
      <td>8049.019608</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9003</td>
      <td>COYOACÁN</td>
      <td>614447</td>
      <td>POLYGON ((-11036128.811 2196996.411, -11035960...</td>
      <td>1625</td>
      <td>229.099112</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9016</td>
      <td>MIGUEL HIDALGO</td>
      <td>414470</td>
      <td>POLYGON ((-11041844.793 2210106.057, -11041853...</td>
      <td>1027</td>
      <td>200.742768</td>
    </tr>
  </tbody>
</table>
</div>
</div>

<p>We are now ready to combine the data into a single interactive map.</p>

<h2 id="build-an-interactive-choropleth-map">Build an Interactive Choropleth Map</h2>

<p>Display AGEB and neighbourhood in two FeatureGroup layers map:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Create map instance, set location
</span><span class="n">vaw_map</span> <span class="o">=</span><span class="n">folium</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mf">19.32096</span><span class="p">,</span><span class="o">-</span><span class="mf">99.15261</span><span class="p">],</span> 
                   <span class="n">tiles</span> <span class="o">=</span> <span class="s">'cartodbpositron'</span><span class="p">,</span> 
                   <span class="n">zoom_start</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">control_scale</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1">#set two layer
</span><span class="n">fg1</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">FeatureGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'VAW rate per AGEB'</span><span class="p">,</span><span class="n">overlay</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">vaw_map</span><span class="p">)</span>
<span class="n">fg2</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">FeatureGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'VAW rate per Neighbourhood'</span><span class="p">,</span><span class="n">overlay</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">vaw_map</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Add the first choropleth map layer to fg1
</span><span class="n">custom_scale1</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s">'VAW_per_1000'</span><span class="p">].</span><span class="n">quantile</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mi">1</span><span class="p">))).</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">ageb</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Choropleth</span><span class="p">(</span>
        <span class="n">geo_data</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s">'vaw in 2021'</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'CVEGEO'</span><span class="p">,</span> <span class="s">'VAW_per_1000'</span><span class="p">],</span>
        <span class="n">key_on</span><span class="o">=</span><span class="s">'feature.properties.CVEGEO'</span><span class="p">,</span>
        <span class="n">fill_color</span><span class="o">=</span><span class="s">'YlOrRd'</span><span class="p">,</span>
        <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">line_opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">line_color</span><span class="o">=</span><span class="s">'white'</span><span class="p">,</span> 
        <span class="n">line_weight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
        <span class="n">smooth_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">threshold_scale</span><span class="o">=</span><span class="n">custom_scale1</span><span class="p">,</span>
        <span class="n">legend_name</span><span class="o">=</span> <span class="s">'Rates of violence against women per 1000 in CDMX, 2021'</span><span class="p">,</span>
    <span class="n">overlay</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">geojson</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">fg1</span><span class="p">)</span>


<span class="n">folium</span><span class="p">.</span><span class="n">features</span><span class="p">.</span><span class="n">GeoJson</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">gdf</span><span class="p">,</span>
                    <span class="n">smooth_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">style_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="s">'color'</span><span class="p">:</span><span class="s">'white'</span><span class="p">,</span><span class="s">'fillColor'</span><span class="p">:</span><span class="s">'transparent'</span><span class="p">,</span><span class="s">'weight'</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
                    <span class="n">tooltip</span><span class="o">=</span><span class="n">folium</span><span class="p">.</span><span class="n">features</span><span class="p">.</span><span class="n">GeoJsonTooltip</span><span class="p">(</span>
                        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">'POBTOT'</span><span class="p">,</span>
                                <span class="s">'VAW_COUNT'</span><span class="p">,</span>
                                <span class="s">'VAW_per_1000'</span><span class="p">,</span>
                                <span class="s">'PDESOCUP'</span><span class="p">,</span>
                                <span class="s">'GRAPROES'</span>
                               <span class="p">],</span>
                        <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s">"Total Population, &lt;br&gt;(Per AGEB):"</span><span class="p">,</span>
                                 <span class="s">"Reported cases:"</span><span class="p">,</span>
                                 <span class="s">"VAW rate per 1000:"</span><span class="p">,</span>
                                 <span class="s">"Pop Unemployed:"</span><span class="p">,</span>
                                 <span class="s">"Degree of Education:"</span>
                                <span class="p">],</span> 
                        <span class="n">localize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">sticky</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">style</span><span class="o">=</span><span class="s">"""
                            background-color: #F0EFEF;
                            border: 2px solid black;
                            border-radius: 3px;
                            box-shadow: 3px;
                        """</span><span class="p">,</span>
                        <span class="n">max_width</span><span class="o">=</span><span class="mi">800</span><span class="p">,),</span>
                            <span class="n">highlight_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="s">'weight'</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s">'fillColor'</span><span class="p">:</span><span class="s">'grey'</span><span class="p">},</span>
                        <span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">ageb</span><span class="p">)</span>

<span class="c1">#Add the 2nd choropleth map layer to fg2
</span><span class="n">custom_scale2</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdf_mun</span><span class="p">[</span><span class="s">'VAW_per_1000'</span><span class="p">].</span><span class="n">quantile</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mi">1</span><span class="p">))).</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">neighb</span> <span class="o">=</span> <span class="n">folium</span><span class="p">.</span><span class="n">Choropleth</span><span class="p">(</span>
    <span class="n">geo_data</span><span class="o">=</span><span class="n">gdf_mun</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s">'vaw per Neighbourhood'</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">gdf_mun</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'CVEGEO'</span><span class="p">,</span> <span class="s">'VAW_per_1000'</span><span class="p">],</span>
    <span class="n">key_on</span><span class="o">=</span><span class="s">'feature.properties.CVEGEO'</span><span class="p">,</span>
    <span class="n">fill_color</span><span class="o">=</span><span class="s">'YlOrRd'</span><span class="p">,</span>
    <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">line_opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">line_color</span><span class="o">=</span><span class="s">'white'</span><span class="p">,</span> 
    <span class="n">line_weight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
    <span class="n">smooth_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold_scale</span><span class="o">=</span><span class="n">custom_scale2</span><span class="p">,</span>
    <span class="n">legend_name</span><span class="o">=</span> <span class="s">'Incidents of violence against women in CDMX, 2021'</span><span class="p">,</span>
    <span class="n">overlay</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">geojson</span><span class="p">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">fg2</span><span class="p">)</span>

<span class="n">folium</span><span class="p">.</span><span class="n">features</span><span class="p">.</span><span class="n">GeoJson</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">gdf_mun</span><span class="p">,</span>
                    <span class="n">smooth_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">style_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="s">'color'</span><span class="p">:</span><span class="s">'white'</span><span class="p">,</span><span class="s">'fillColor'</span><span class="p">:</span><span class="s">'transparent'</span><span class="p">,</span><span class="s">'weight'</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
                    <span class="n">tooltip</span><span class="o">=</span><span class="n">folium</span><span class="p">.</span><span class="n">features</span><span class="p">.</span><span class="n">GeoJsonTooltip</span><span class="p">(</span>
                        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">'NOMGEO'</span><span class="p">,</span>
                                <span class="s">'POBTOT'</span><span class="p">,</span>
                                <span class="s">'VAW_COUNT'</span><span class="p">,</span>
                                <span class="s">'VAW_per_1000'</span><span class="p">,</span>
                               <span class="p">],</span>
                        <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s">"Neighbourhood:"</span><span class="p">,</span>
                                 <span class="s">"Population:"</span><span class="p">,</span>
                                 <span class="s">"Reported Cases:"</span><span class="p">,</span>
                                 <span class="s">"VAW rate per 1000:"</span>
                                 
                                <span class="p">],</span> 
                        <span class="n">localize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">sticky</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">style</span><span class="o">=</span><span class="s">"""
                            background-color: #F0EFEF;
                            border: 2px solid black;
                            border-radius: 3px;
                            box-shadow: 3px;
                        """</span><span class="p">,</span>
                        <span class="n">max_width</span><span class="o">=</span><span class="mi">800</span><span class="p">,),</span>
                            <span class="n">highlight_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="s">'weight'</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s">'fillColor'</span><span class="p">:</span><span class="s">'grey'</span><span class="p">},</span>
                        <span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">neighb</span><span class="p">)</span>   


<span class="c1">#Add layer control to the map
</span><span class="n">folium</span><span class="p">.</span><span class="n">TileLayer</span><span class="p">(</span><span class="s">'cartodbdark_matter'</span><span class="p">,</span><span class="n">overlay</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">"View in Dark Mode"</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">vaw_map</span><span class="p">)</span>
<span class="n">folium</span><span class="p">.</span><span class="n">TileLayer</span><span class="p">(</span><span class="s">'cartodbpositron'</span><span class="p">,</span><span class="n">overlay</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">"Viw in Light Mode"</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">vaw_map</span><span class="p">)</span>
<span class="n">folium</span><span class="p">.</span><span class="n">LayerControl</span><span class="p">(</span><span class="n">collapsed</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">add_to</span><span class="p">(</span><span class="n">vaw_map</span><span class="p">)</span>
<span class="c1">#Add mini map
</span><span class="n">folium</span><span class="p">.</span><span class="n">plugins</span><span class="p">.</span><span class="n">MiniMap</span><span class="p">().</span><span class="n">add_to</span><span class="p">(</span><span class="n">vaw_map</span><span class="p">)</span>

<span class="c1">#vaw_map.save("output/CDMX_VAW_Folium.html") #save to a file
#vaw_map
</span></code></pre></div></div>

<iframe src="/img/output/CDMX_VAW_Folium.html" height="800px" width="100%"></iframe>

<p>Et Voilà! Click on the legend entries to hide and show the layer.</p>

<p>The AGEB layer visually suggests that there are spatial clusters of where VAW is more prevalent, but can this pattern be a matter of chance?</p>

<p>To answer this question, I need to conduct the spatial correlation analysis.
Go to the next page.</p>

<p><span style="white-space: pre"></span></p>

<p align="right">
    <a class="btn btn-light" href="/3_spatialCorr" role="button">Next</a>
</p>


      </div>
    </div>
  </div>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:cecilia.sartori@studenti.unitn.it">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/cecilia-sartori">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; cecilia sartori 2022</p>
      </div>
    </div>
  </div>
</footer>


  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/scripts.js"></script>

<script src="/assets/scripts.js"></script>





</body>

</html>
